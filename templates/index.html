<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <title>BouwBot NL</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <!-- Bootstrap 5 (CSS only) -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
    <script src="https://cdn.jsdelivr.net/npm/proj4@2.9.0/dist/proj4.js"></script>
    <!-- OpenLayers -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/ol@latest/ol.css" />
    <script src="https://cdn.jsdelivr.net/npm/ol@latest/dist/ol.js"></script>

    <!-- Optional small custom CSS -->
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css" rel="stylesheet" />


</head>

<body class="bg-light">


    <!-- Main layout -->
    <div class="container-fluid">
        <div class="row">

            <!-- LEFT: Chat -->
            <div class="col-md-4 col-lg-3 border-end bg-white left_chat">

                <div id="chatIntro" class="p-3 border-bottom">

                    <h1 class="mb-1">üè¢ BouwBot NL</h1>
                    <p class="text-muted large mb-3">
                        Chat-based analysis of 3D buildings in the Netherlands
                    </p>

                    <p class="small">
                        BouwBot NL allows you to explore Dutch building data using
                        natural language queries.
                    </p>



                    <!-- Allowed functions (collapsible) -->
                    <div class="accordion" id="allowedFunctions">
                        <div class="accordion-item">
                            <h2 class="accordion-header">
                                <button class="accordion-button collapsed py-2 px-3 small" type="button"
                                    data-bs-toggle="collapse" data-bs-target="#allowedFunctionsBody">
                                    Example Queries
                                </button>
                            </h2>

                            <div id="allowedFunctionsBody" class="accordion-collapse collapse"
                                data-bs-parent="#allowedFunctions">
                                <div class="accordion-body small">
                                    <p class="mb-2">
                                        This chat supports a <strong>limited set of spatial analyses</strong>
                                        based on Dutch 3D building data (BAG 3D).
                                    </p>

                                    <strong>Supported question types:</strong>
                                    <ul class="ps-3 mb-0">
                                        <li>Show Utrecht Maliebaan on the map</li>
                                        <li>Draw a 500 meter buffer around selected location</li>
                                        <li>Show buildings within 300 meters in selected location</li>
                                        <li>Show buildings higher than 5 meters within 300 meters in selected location
                                        </li>
                                        <!-- Height statistics -->
                                        <li>What is the minimum, average, and maximum building height within 500 meters of this point?</li>
                                        <li>Give height statistics for buildings within 300 meters of this point</li>

                                        <!-- Tallest building -->
                                        <li>Which is the tallest building within 300 meters of this point?</li>
                                        <!-- <li>Show the tallest building around this location</li> -->

                                        <!-- Footprint analysis -->
                                        <li>What is the average building footprint within 400 meters of this point?</li>
                                        <!-- <li>Show footprint statistics for buildings near this point</li> -->

                                        <!-- Volume analysis -->
                                        <li>What is the total building volume within 500 meters of this point?</li>
                                        <!-- <li>Calculate total and average building volume in this area</li> -->

                                        <!-- Polygon-based analysis -->
                                        <!-- <li>Show buildings inside the drawn polygon</li>
                                        <li>Find buildings higher than 20 meters inside the selected area</li>
                                        <li>Give height statistics for buildings inside this polygon</li> -->

                                    </ul>

                                    <p class="text-muted  mb-0">
                                        Questions outside these topics are not supported.
                                    </p>

                                    <hr class="my-2">

                                    <p class="mb-1">
                                        <strong>Data source:</strong>
                                        <a href="https://3dbag.nl/en/download" target="_blank" rel="noopener">
                                            3D BAG (3DBAG)
                                        </a>
                                    </p>

                                    <p class="mb-0">
                                        The 3D BAG dataset is available for the <strong>entire Netherlands</strong>.
                                        For this demo, analysis is currently limited to <strong>Utrecht</strong>
                                        to keep data size, performance, and computational complexity manageable.
                                    </p>


                                </div>
                            </div>
                        </div>
                    </div>

                </div>

                <!-- Messages -->
                <div id="chatMessages" class="flex-grow-1 p-3 overflow-auto">

                </div>
                <form id="chatForm" class="p-3 border-top">
                    <div class="input-group align-items-end">
                        <textarea id="chatInput" class="form-control" rows="1" placeholder="Ask a question‚Ä¶"
                            style="resize:none; overflow-y:auto;"></textarea>

                        <button class="btn btn-primary chat-send-btn" type="submit" title="Send">
                            <i class="bi bi-send-fill"></i>
                        </button>
                    </div>
                </form>



            </div>

            <!-- RIGHT: Map -->
            <div class="col-md-8 col-lg-9 d-flex flex-column p-0">

                <!-- Map toolbar -->
                <div class="p-2 border-bottom bg-white d-flex flex-wrap gap-2 align-items-center" style="height: 50px;">

                    <span class="fw-semibold small">Basemap:</span>

                    <select id="basemapSelect" class="form-select form-select-sm w-auto">
                        <option value="osm" selected>OpenStreetMap</option>
                        <option value="google">Google Streets</option>
                    </select>

                    <!-- <span class="ms-3 fw-semibold small">Layers:</span>

                    <div class="form-check form-switch">
                        <input class="form-check-input" type="checkbox" id="bag3dToggle" />
                        <label class="form-check-label small" for="bag3dToggle">
                            BAG 3D (WFS)
                        </label>
                    </div> -->

                    <div class="vr mx-2"></div>

                    <select id="drawType" class="form-select form-select-sm w-auto">
                        <option value="None">Draw: None</option>
                        <option value="Point">Point</option>
                        <option value="Polygon">Polygon</option>
                    </select>

                    <button id="btnDelete" class="btn btn-outline-danger btn-sm">
                        Delete
                    </button>

                    <button id="btnClearChat" class="btn btn-sm btn-outline-danger">
  Clear chat history
</button>

                    <button id="btnExportMap" class="btn btn-sm btn-success" title="Export map as PNG">
                        <i class="bi bi-download"></i> Export Map
                    </button>



                </div>


                <!-- Map -->
                <div id="map" class="">

                    <!-- OpenLayers popup -->
                    <div id="olPopup" class="ol-popup">
                        <a href="#" id="olPopupCloser" class="ol-popup-closer"></a>
                        <div id="olPopupContent"></div>
                    </div>


                </div>

            </div>

        </div>
    </div>

    <!-- html2canvas for map export -->
    <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>

    <!-- App JS -->
    <script src="{{ url_for('static', filename='app.js') }}"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>


    <script src="https://cdn.jsdelivr.net/npm/dompurify@3.1.6/dist/purify.min.js"></script>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

</body>

</html>