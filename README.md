# ðŸ¢ BouwBot NL 

**BouwBot NL** is an open-source, chat-based geospatial analysis tool
for exploring 3D building data in the Netherlands.
(â€œBouwâ€ = building in Dutch)

BouwBot NL is a conversational geospatial analysis tool that allows users to explore and analyze 3D building data in the Netherlands using natural language. The system translates chat-based queries into vector-based spatial operations on building footprints and height attributes.

The application will be designed to make Dutch 3D building datasets accessible to non-GIS users, while still producing accurate, reproducible spatial analysis results.
BouwBot NL supports a controlled set of interpretable queries, mapped to explicit spatial operations.

Tool utilized 3DBAG open source building dataset and ChatGPT API 

Key characteristics:

- Chat-driven analysis: users ask questions in natural language
- Tool-based execution: the assistant calls predefined tools (Python functions) for spatial analysis
- Reproducible outputs: results are returned as map layers and exported GeoJSON files
- Safety by design: unsupported topics are refused (no hallucinated results)

## 1) Example queries:
**For this demo, analysis is currently limited to Utrecht to keep data size, performance, and computational complexity manageable.**

- Show Utrecht Maliebaan on the map
- Draw a 500 meter buffer around selected location
- Show buildings within 300 meters in selected location
- Show buildings higher than 5 meters within 300 meters in selected location
- What is the minimum, average, and maximum building height within 500 meters of this point?
- Give height statistics for buildings within 300 meters of this point
- Which is the tallest building within 300 meters of this point?
- What is the average building footprint within 400 meters of this point?
- What is the total building volume within 500 meters of this point?
> âŒ Questions outside these categories (prices, predictions, energy use, zoning laws, etc.) are **not supported** in this demo.


![BouwBot NL demo](static/demo.gif)

---



## 2) Data Source
BouwBot NL uses the **3DBAG** dataset (https://3dbag.nl/en/download).

The 3DBAG is an up-to-date data set containing 3D building models of the Netherlands. The 3DBAG is open data. It contains 3D models at multiple levels of detail, which are generated by combining two open data sets: the building data from the BAG and the height data from the AHN. 

> This demo currently uses **Utrecht only** because nationwide data is large and more complex to run locally. 



### Clip the dataset to Utrecht 
To keep the demo lightweight, we clip the Netherlands dataset to the **Utrecht boundary** using **GDAL**.

You can reproduce this process using:

- Notebook: `3dbag_data_processing.ipynb`
- Requirement: **GDAL installed locally**

This notebook:
- Download data from the official 3DBAG website: https://3dbag.nl/en/download
- loads the nationwide GeoPackage
- clips to Utrecht boundary using gdal
- exports a smaller GeoPackage suitable for local analysis


### Download the pre-clipped Utrecht dataset (optional)
If you donâ€™t want to run the clipping step, you can download the already clipped Utrecht dataset here:

https://universiteittwente-my.sharepoint.com/:u:/g/personal/a_chaudhary_student_utwente_nl/IQDHtQgJgGP0TL5GC5U3clYiAcVRjKkvsy1vtP7zpr0LpNE?e=ykg9lp


Once you have the clipped GeoPackage, place it here: 
`/static/data/utrecht_pand_clip.gpkg`

---


## 3) Tool Setup
This section explains how to set up and run BouwBot NL locally.

```
1. Clone the project repository to your local machine.
git clone git@github.com:amanchry/BouwBot-NL.git
cd BouwBot-NL

2. Create and activate a virtual environment
python3 -m venv venv

3. Activate the virtual environment:
source venv/bin/activate        # macOS / Linux
venv\Scripts\activate           # windows

<!-- Once activated, your terminal prompt should indicate that the virtual environment is active. -->

4. Install Python dependencies
pip install -r requirements.txt


5. Configure environment variables
Create a .env file in the project root directory and add the following:

OPENAI_API_KEY=your_openai_key
FLASK_SECRET_KEY=ververysecretkeyxdxdxdx

6. Run the application
<!-- Start the Flask development server: -->

python app.py

7. Once the server is running, open your browser and navigate to: http://127.0.0.1:8000
<!-- You should now see the BouwBot NL interface with the map and chat panel ready for use. -->
```

## 4) System Architecture
BouwBot NL is designed as a **tool-driven conversational geospatial system**.  
Rather than generating answers directly, the AI assistant **routes user queries to explicit spatial analysis tools**, ensuring transparency, reproducibility, and correctness.

### High-level architecture

The system consists of five main components:
```
    User (Browser)
    â†“
    Chat UI + Map (OpenLayers)
    â†“
    Flask Backend API
    â†“
    LLM (ChatGPT with tool calling)
    â†“
    Geospatial Tools (GeoPandas / Shapely)
    â†“
    GeoJSON Output â†’ Map Rendering
```

### Technologies used

**Flask**  
Flask is a lightweight Python web framework used to build the backend API, manage user sessions, and serve generated GeoJSON outputs.
Documentation: https://flask.palletsprojects.com/


**OpenAI API**  
The OpenAI Chat Completions API is used to interpret user queries and route them to predefined geospatial tools via function calling. 
Documentation: https://platform.openai.com/docs/guides/function-calling


**OpenLayers**  
OpenLayers is a JavaScript mapping library used for rendering the interactive map.
Documentation: https://openlayers.org/



### How it works

1. The user submits a question via the chat interface and may draw a point or polygon on the map.
2. The frontend sends the message and optional geometry (GeoJSON) to the Flask backend.
3. The language model interprets the request and **selects a predefined geospatial tool**.
4. The selected tool performs spatial analysis using 3DBAG building data.
5. Results are exported as GeoJSON and returned as map layers.
6. The frontend renders the results and displays a textual explanation.

### Key design principles

- **Tool-based execution:** the AI never computes results directly
- **Reproducibility:** every answer maps to a concrete spatial operation
- **Meter-accurate analysis:** calculations use EPSG:28992 (RD New)
- **Lightweight frontend:** large geometries are loaded via GeoJSON URLs


### Current limitations

- Analysis is limited to **Utrecht**
- Only predefined geospatial queries are supported
- Non-spatial or predictive questions are not handled



## 5) Testing




## License

This project is licensed under the **MIT License**.

You are free to use, modify, and distribute this software with proper attribution.


